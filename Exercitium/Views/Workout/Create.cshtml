@using Exercitium.ViewModels;
@model WorkoutCreateViewModel

<h2>Create Workout</h2>

@using (Html.BeginForm("Create", "Workout"))
{
    <div class="form-group">
        @Html.LabelFor(m => m.Type)
        @Html.TextBoxFor(m => m.Type, new { @class = "form-control" })
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.DateTime)
        @Html.TextBoxFor(m => m.DateTime, new { @class = "form-control", @type = "date" })
    </div>

    <h4>Exercises</h4>

    <ul id="availableExercises">
        @for (var i = 0; i < Model.Exercises.Count; i++)
        {
            <li>
                @Html.HiddenFor(m => m.Exercises[i].IsSelected)
                <input type="checkbox" asp-for="Exercises[i].IsSelected" name="Exercises[@i].IsSelected" id="exercise_@i" data-exercise-id="@i" data-exercise-name="@Model.Exercises[i].ExerciseName" />
                <label for="exercise_@i" asp-for="Exercises[i].IsSelected">@Model.Exercises[i].ExerciseName</label>
            </li>
        }
    </ul>

    <h4>Selected Exercises:</h4>
    <table id="selectedExercisesTable">
        <thead>
            <tr>
                <th>Exercise</th>
                <th>Sets</th>
                <th>Reps</th>
                <th>Weight</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>


    <button type="submit" class="btn btn-primary">Create</button>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            // Handle exercise checkbox change event
            $('#availableExercises').on('change', 'input[type="checkbox"]', function () {
                var exerciseId = $(this).data('exercise-id');
                var exerciseName = $(this).data('exercise-name');

                if ($(this).is(':checked')) {
                    var exerciseRow = $('#selectedExercisesTable tbody').find('tr[data-exercise-id="' + exerciseId + '"]');
                    if (exerciseRow.length === 0) {
                        // Add exercise to the table if it doesn't exist
                        var tableBody = $('#selectedExercisesTable tbody');
                        var exerciseIndex = tableBody.children('tr').length;
                        var row = '<tr data-exercise-id="' + exerciseId + '">'
                            + '<td>' + exerciseName + '</td>'
                            + '<td><input type="number" name="Exercises[' + exerciseIndex + '].Sets" /></td>'
                            + '<td><input type="number" name="Exercises[' + exerciseIndex + '].Reps" /></td>'
                            + '<td><input type="number" name="Exercises[' + exerciseIndex + '].Weight" /></td>'
                            + '<td><a href="#" class="deleteExercise">Delete</a></td>'
                            + '</tr>';
                        tableBody.append(row);
                    }
                } else {
                    // Remove exercise from the table
                    var tableBody = $('#selectedExercisesTable tbody');
                    tableBody.find('tr[data-exercise-id="' + exerciseId + '"]').remove();
                }
            });

            // Handle delete exercise click event
            $('#selectedExercisesTable').on('click', '.deleteExercise', function (e) {
                e.preventDefault();
                var row = $(this).closest('tr');
                var exerciseId = row.data('exercise-id');
                var exerciseCheckbox = $('#exercise_' + exerciseId);
                exerciseCheckbox.prop('checked', false); // Uncheck the checkbox
                row.remove();
            });
        });

    </script>
}

